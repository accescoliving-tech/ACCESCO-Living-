# Grokly Vendor Dashboard - Supabase Setup Guide

## Problem
The vendor dashboard cannot add new listing data because the Supabase database is not properly configured.

## Solution

### Step 1: Create the Products Table

Go to your Supabase Project → SQL Editor and run this SQL:

```sql
-- Create Products Table
CREATE TABLE IF NOT EXISTS public.products (
    id bigint generated by default as identity primary key,
    created_at timestamptz default now(),
    name text not null,
    price numeric not null,
    category text not null,
    qty text not null,
    stock integer default 0,
    vendor_id integer not null,
    image_url text
);

-- Create Orders Table
CREATE TABLE IF NOT EXISTS public.orders (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    created_at timestamptz DEFAULT now(),
    items jsonb NOT NULL,
    total_amount numeric NOT NULL,
    address jsonb NOT NULL,
    status text DEFAULT 'pending'
);

-- Create Indexes for performance
CREATE INDEX IF NOT EXISTS idx_products_vendor_id ON products(vendor_id);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
```

### Step 2: Enable Realtime

```sql
-- Enable Realtime for both tables
ALTER PUBLICATION supabase_realtime ADD TABLE products;
ALTER PUBLICATION supabase_realtime ADD TABLE orders;
```

### Step 3: Disable RLS or Set Proper Policies

**Option A: Disable RLS (for development/testing):**
1. Go to Authentication → Policies in Supabase
2. For `products` table: Click on RLS toggle to disable it
3. For `orders` table: Click on RLS toggle to disable it

**Option B: Set RLS Policies (for production):**

```sql
-- Enable RLS
ALTER TABLE products ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- Products - Allow public read, vendor write
CREATE POLICY "Allow public read" ON products FOR SELECT USING (true);
CREATE POLICY "Vendors can insert their own products" ON products 
  FOR INSERT WITH CHECK (vendor_id = current_setting('app.current_vendor_id')::integer);

-- Orders - Allow public read, vendor operations
CREATE POLICY "Allow public read orders" ON orders FOR SELECT USING (true);
CREATE POLICY "Allow order inserts" ON orders FOR INSERT WITH CHECK (true);
```

### Step 4: Create Storage Bucket for Images

1. Go to Storage → Buckets in Supabase
2. Click "New Bucket"
3. Name it: `product-images`
4. Make it **Public**
5. Set CORS policy (if needed)

### Step 5: Test the Connection

1. Open [services-grokly_vendor.html](services-grokly_vendor.html) in your browser
2. Enter a Vendor ID (e.g., 101)
3. Click "Launch Dashboard"
4. Fill in the form and click "Save Listing"

## Troubleshooting

### Error: "Cannot connect to database"
- Check your Supabase URL and key in the HTML file (line 352-353)
- Verify the project is active in Supabase dashboard
- Check internet connectivity

### Error: "Error: INSERT policy violation"
- RLS is enabled without proper policies
- Either disable RLS (Step 3 Option A) or set policies (Step 3 Option B)

### Error: "Storage bucket not found"
- Create the `product-images` bucket (Step 4)
- Make sure it's public and not private

### Images not uploading but product saves
- This is normal! The code falls back to a placeholder image
- Create the storage bucket to enable image uploads

## Supabase Credentials Used
- **URL**: https://nfdrnbikwzfmijrqmoqt.supabase.co
- **Key**: sb_publishable_dVvOYAqamp2BGoI8zvyB5g_NfCSkQ6b

⚠️ **Note**: These credentials are for client-side use only. Consider rotating them if exposed publicly.

## Next Steps
1. Complete all Supabase setup steps above
2. Test with the vendor dashboard
3. Check browser console (F12) for detailed error messages if issues persist
